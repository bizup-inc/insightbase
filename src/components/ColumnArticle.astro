---
import Author from "./Author.astro";
import Sidebar from "./Sidebar.astro";
import type { ColumnContent } from "../lib/microcms";
import { formatDateJa, getCategoryLabel, getEyecatchUrl, getTagEntries } from "../lib/microcms";

interface Props {
  article: ColumnContent;
  isPreview?: boolean;
}

const { article, isPreview = false } = Astro.props as Props;

const categoryLabel = getCategoryLabel(article.category);
const tags = getTagEntries(article.tag);
const firstTag = tags[0];
const publishedDate = formatDateJa(article.publishedAt || article.createdAt);
const eyecatchUrl = getEyecatchUrl(article.eyecatch);
---

<section class="column-page">
  <div class="content__inner column-page__inner">
    <article class="column-article">
      <header class="column-article__header">
        {isPreview && <p class="column-article__preview">プレビュー表示中</p>}
        <nav class="column-breadcrumb" aria-label="パンくずリスト">
          <a href="/">TOP</a>
          <span>/</span>
          <a href="/knowledge">コラム一覧</a>
          {firstTag && (
            <>
              <span>/</span>
              <a href={`/knowledge/tag/${encodeURIComponent(firstTag.slug)}`}>{firstTag.label}</a>
            </>
          )}
          <span>/</span>
          <span aria-current="page">{article.title}</span>
        </nav>
        {categoryLabel && <p class="column-article__category">{categoryLabel}</p>}
        <h1>{article.title}</h1>
        {publishedDate && (
          <div class="column-article__meta">
            <time datetime={article.publishedAt || article.createdAt}>{publishedDate}</time>
            {tags.map((tag) => (
              <a href={`/knowledge/tag/${encodeURIComponent(tag.slug)}`} class="column-tag-link">
                #{tag.label}
              </a>
            ))}
          </div>
        )}
      </header>

      {eyecatchUrl && (
        <figure class="column-article__hero">
          <img src={eyecatchUrl} alt={article.title} />
        </figure>
      )}

      <div class="column-article__body" set:html={article.content} />

      <Author />
    </article>

    <Sidebar />
  </div>
</section>
